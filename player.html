<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Radio Radicale Player UNOFFICIAL</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --orange: #EA580C;
      --orange-light: #FFF7ED;
      --orange-mid: #FDBA74;
      --black: #111111;
      --gray-dark: #444444;
      --gray-mid: #888888;
      --gray-light: #E5E5E5;
      --white: #FFFFFF;
    }

    html, body {
      min-height: 100%;
      min-height: -webkit-fill-available;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--white);
      color: var(--black);
      display: flex;
      flex-direction: column;
      min-height: 100svh;
      overflow-x: hidden;
    }

    /* ── DECORATIVE BAR ── */
    .top-bar {
      height: 4px;
      background: linear-gradient(90deg, var(--orange) 0%, #FB923C 50%, #FED7AA 100%);
    }

    /* ── HEADER ── */
    header {
      padding: 28px 24px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 400;
      color: var(--gray-mid);
      text-decoration: none;
      transition: color 0.15s;
    }

    .back-link:hover { color: var(--orange); }

    .back-link svg {
      width: 16px;
      height: 16px;
    }

    .badge-unofficial {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--orange);
      background: var(--orange-light);
      border: 1px solid var(--orange-mid);
      padding: 5px 10px;
      border-radius: 100px;
    }

    .badge-unofficial::before {
      content: '';
      width: 6px;
      height: 6px;
      background: var(--orange);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }

    /* ── MAIN CONTAINER ── */
    main {
      flex: 1;
      padding: 0 24px 32px;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
    }

    /* ── PAGE TITLE ── */
    .page-title {
      text-align: center;
      margin-bottom: 32px;
      animation: fadeUp 0.6s ease both;
    }

    .page-title h1 {
      font-family: 'Playfair Display', serif;
      font-weight: 900;
      font-size: clamp(28px, 7vw, 42px);
      line-height: 1.1;
      color: var(--black);
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }

    .page-title .subtitle {
      font-size: 13px;
      font-weight: 300;
      color: var(--gray-mid);
      line-height: 1.5;
    }

    .page-title .curator {
      font-size: 11px;
      font-weight: 400;
      color: var(--gray-mid);
      margin-top: 4px;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ── URL INPUT ── */
    .url-section {
      margin-bottom: 32px;
      animation: fadeUp 0.6s 0.1s ease both;
    }

    .url-label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: var(--gray-dark);
      margin-bottom: 10px;
      letter-spacing: 0.01em;
    }

    .url-bar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .url-input-wrap {
      position: relative;
      flex: 1;
      min-width: 200px;
    }

    .url-input {
      width: 100%;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      padding: 14px 38px 14px 16px;
      border: 1.5px solid var(--gray-light);
      border-radius: 12px;
      outline: none;
      transition: all 0.2s;
      background: var(--white);
      color: var(--black);
      -webkit-user-select: text;
      user-select: text;
    }

    .url-input:focus {
      border-color: var(--orange);
      box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
    }

    .url-input::placeholder {
      color: var(--gray-mid);
      opacity: 0.6;
    }

    .clear-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--gray-mid);
      font-size: 18px;
      cursor: pointer;
      padding: 4px;
      line-height: 1;
      transition: color 0.15s;
      display: none;
    }

    .clear-btn.visible { display: block; }
    .clear-btn:hover { color: var(--orange); }

    .load-btn {
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 500;
      padding: 14px 28px;
      background: var(--orange);
      color: var(--white);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.18s ease;
      box-shadow: 0 4px 16px rgba(234, 88, 12, 0.25);
      white-space: nowrap;
    }

    .load-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(234, 88, 12, 0.35);
    }

    .load-btn:active {
      transform: translateY(0);
    }

    .load-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .url-hint {
      font-size: 11px;
      color: var(--gray-mid);
      margin-top: 8px;
    }

    /* ── PLAYER GRID ── */
    .player-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
      animation: fadeUp 0.6s 0.2s ease both;
    }

    @media (min-width: 1024px) {
      .player-grid {
        grid-template-columns: 2fr 1fr;
      }
    }

    /* ── PLAYER COLUMN ── */
    .player-column {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* ── TRACK SELECTOR ── */
    .track-selector {
      display: none;
    }

    .track-selector.visible {
      display: block;
    }

    .track-selector-label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: var(--gray-dark);
      margin-bottom: 10px;
    }

    .track-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .track-btn {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border: 1.5px solid var(--gray-light);
      border-radius: 12px;
      background: var(--white);
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'DM Sans', sans-serif;
      text-align: left;
    }

    .track-btn:hover {
      border-color: var(--orange-mid);
      background: var(--orange-light);
    }

    .track-btn.active {
      border-color: var(--orange);
      background: var(--orange-light);
    }

    .track-btn-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--orange), #FB923C);
      color: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .track-btn-info {
      flex: 1;
      min-width: 0;
    }

    .track-btn-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--black);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-btn-subtitle {
      font-size: 11px;
      color: var(--gray-mid);
      margin-top: 2px;
    }

    .track-btn-icon {
      color: var(--orange);
      font-size: 10px;
      flex-shrink: 0;
    }

    .track-btn.active .track-btn-icon {
      display: block;
    }

    .track-btn:not(.active) .track-btn-icon {
      display: none;
    }

    /* ── WAVEFORM ── */
    .waveform {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      height: 64px;
      margin-bottom: 24px;
    }

    .wave-bar {
      width: 4px;
      background: linear-gradient(180deg, var(--orange) 0%, #FB923C 100%);
      border-radius: 2px;
      opacity: 0.3;
      transition: opacity 0.3s;
    }

    .wave-bar.playing {
      opacity: 1;
    }

    @keyframes wave {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(0.6); }
    }

    .wave-bar.playing {
      animation: wave 1s ease-in-out infinite;
    }

    .wave-bar:nth-child(1) { height: 16px; animation-delay: 0s; }
    .wave-bar:nth-child(2) { height: 28px; animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { height: 48px; animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { height: 32px; animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { height: 40px; animation-delay: 0.4s; }
    .wave-bar:nth-child(6) { height: 24px; animation-delay: 0.5s; }
    .wave-bar:nth-child(7) { height: 36px; animation-delay: 0.6s; }

    /* ── PROGRESS BAR ── */
    .progress-section {
      margin-bottom: 24px;
    }

    .progress-time {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 12px;
      color: var(--gray-mid);
      font-variant-numeric: tabular-nums;
    }

    .progress-bar-container {
      position: relative;
      height: 8px;
      background: var(--gray-light);
      border-radius: 100px;
      cursor: pointer;
    }

    .progress-bar {
      position: absolute;
      height: 100%;
      background: linear-gradient(90deg, var(--orange), #FB923C);
      border-radius: 100px;
      transition: width 0.1s;
    }

    .progress-handle {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 16px;
      height: 16px;
      background: var(--white);
      border: 2px solid var(--orange);
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(234, 88, 12, 0.3);
      opacity: 0;
      transition: opacity 0.2s, transform 0.2s;
      pointer-events: none;
    }

    .progress-bar-container:hover .progress-handle {
      opacity: 1;
    }

    .progress-handle.seeking {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }

    /* ── INTERVENTI MARKERS ── */
    .intervento-marker {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background: var(--orange);
      border: 2px solid var(--white);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
      z-index: 10;
    }

    .intervento-marker:hover {
      transform: translate(-50%, -50%) scale(1.5);
    }

    .intervento-marker.paragrafo {
      background: var(--gray-mid);
    }

    /* ── CONTROLS ── */
    .controls {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    .controls-buttons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }

    .control-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      background: var(--gray-light);
      color: var(--gray-dark);
    }

    .control-btn:hover:not(:disabled) {
      transform: scale(1.05);
      background: var(--orange-mid);
    }

    .control-btn:active:not(:disabled) {
      transform: scale(0.95);
    }

    .control-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .control-btn.play {
      width: 72px;
      height: 72px;
      background: linear-gradient(135deg, var(--orange), #FB923C);
      color: var(--white);
      box-shadow: 0 4px 20px rgba(234, 88, 12, 0.3);
    }

    .control-btn.play:hover:not(:disabled) {
      box-shadow: 0 6px 28px rgba(234, 88, 12, 0.4);
    }

    .control-btn svg {
      width: 24px;
      height: 24px;
    }

    .control-btn.play svg {
      width: 32px;
      height: 32px;
    }

    .controls-status {
      text-align: center;
      font-size: 13px;
      color: var(--gray-mid);
    }

    /* ── SPEED CONTROL ── */
    .speed-control {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--orange-light);
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .speed-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .speed-slider {
      flex: 1;
      height: 6px;
      border-radius: 100px;
      background: var(--orange-mid);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
    }

    .speed-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--orange);
      cursor: pointer;
      transition: transform 0.15s;
    }

    .speed-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    .speed-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--orange);
      border: none;
      cursor: pointer;
      transition: transform 0.15s;
    }

    .speed-slider::-moz-range-thumb:hover {
      transform: scale(1.2);
    }

    .speed-display {
      font-size: 13px;
      font-weight: 600;
      color: var(--orange);
      min-width: 48px;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    /* ── MESSAGES ── */
    .message {
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 13px;
      margin-bottom: 16px;
      display: none;
      text-align: center;
    }

    .message.visible {
      display: block;
    }

    .message.loading {
      color: var(--orange);
      background: var(--orange-light);
      border: 1px solid var(--orange-mid);
    }

    .message.success {
      color: #059669;
      background: #D1FAE5;
      border: 1px solid #6EE7B7;
    }

    .message.error {
      color: #DC2626;
      background: #FEE2E2;
      border: 1px solid #FCA5A5;
    }

    .loading-spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid var(--orange);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ── INTERVENTI SIDEBAR ── */
    .interventi-container {
      display: none;
    }

    .interventi-container.visible {
      display: block;
    }

    .interventi-header {
      background: linear-gradient(135deg, var(--orange), #FB923C);
      color: var(--white);
      padding: 14px 18px;
      border-radius: 12px 12px 0 0;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .interventi-list {
      border: 1.5px solid var(--gray-light);
      border-top: none;
      border-radius: 0 0 12px 12px;
      max-height: 600px;
      overflow-y: auto;
    }

    .intervento-item {
      padding: 16px;
      border-bottom: 1px solid var(--gray-light);
      transition: all 0.2s;
    }

    .intervento-item:last-child {
      border-bottom: none;
    }

    .intervento-item.clickable {
      cursor: pointer;
    }

    .intervento-item.clickable:hover {
      background: var(--orange-light);
    }

    .intervento-item.active {
      background: var(--orange-light);
      border-left: 4px solid var(--orange);
    }

    .intervento-item.paragrafo {
      background: #F9FAFB;
      padding: 12px 16px;
    }

    .intervento-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--black);
      margin-bottom: 4px;
    }

    .intervento-role {
      font-size: 11px;
      color: var(--gray-mid);
      margin-bottom: 8px;
    }

    .intervento-duration {
      font-size: 11px;
      color: var(--gray-mid);
    }

    .intervento-meta {
      font-size: 11px;
      color: var(--orange);
      margin-top: 4px;
    }

    .intervento-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--gray-dark);
    }

    /* ── FOOTER ── */
    footer {
      padding: 32px 24px;
      text-align: center;
    }

    .footer-disclaimer {
      font-size: 13px;
      color: var(--gray-mid);
      margin-bottom: 12px;
    }

    .footer-disclaimer a {
      color: var(--gray-mid);
      text-decoration: underline;
      transition: color 0.15s;
    }

    .footer-disclaimer a:hover {
      color: var(--black);
    }

    .footer-credits {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
      color: var(--gray-mid);
      padding-top: 8px;
    }

    .footer-credits a {
      color: var(--orange);
      font-weight: 600;
      text-decoration: none;
      transition: color 0.15s;
    }

    .footer-credits a:hover {
      color: #FB923C;
    }

    .footer-credits svg {
      width: 20px;
      height: 20px;
      transition: color 0.15s;
    }

    .footer-credits a:hover svg {
      color: var(--black);
    }

    .footer-license {
      font-size: 11px;
      color: var(--gray-mid);
      margin-top: 8px;
    }

    .footer-license a {
      color: var(--gray-mid);
      text-decoration: none;
      transition: color 0.15s;
    }

    .footer-license a:hover {
      color: var(--gray-dark);
    }

    /* ── RESPONSIVE ── */
    @media (max-width: 640px) {
      header {
        padding: 20px 16px 16px;
      }

      main {
        padding: 0 16px 24px;
      }

      .page-title h1 {
        font-size: 28px;
      }

      .control-btn {
        width: 48px;
        height: 48px;
      }

      .control-btn.play {
        width: 64px;
        height: 64px;
      }

      footer {
        padding: 24px 16px;
      }
    }
  </style>
</head>
<body>

  <!-- Decorative Bar -->
  <div class="top-bar"></div>

  <!-- Header -->
  <header>
    <a href="processi.html" class="back-link">
      <svg fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
      Torna alla ricerca
    </a>
    <span class="badge-unofficial">Unofficial</span>
  </header>

  <!-- Main Content -->
  <main>

    <!-- Page Title -->
    <div class="page-title">
      <h1 id="mainTitle">Radio Radicale Player</h1>
      <p class="subtitle" id="mainSubtitle">Streaming Audio</p>
      <p class="curator" id="curaDi"></p>
    </div>

    <!-- URL Input -->
    <div class="url-section">
      <label class="url-label">URL Pagina Radio Radicale</label>
      <div class="url-bar">
        <div class="url-input-wrap">
          <input 
            type="text" 
            id="pageUrlInput" 
            class="url-input"
            placeholder="https://www.radioradicale.it/scheda/..."
          >
          <button id="clearBtn" class="clear-btn">✕</button>
        </div>
        <button id="loadBtn" class="load-btn">Carica</button>
      </div>
      <p class="url-hint">Incolla l'URL di una pagina Radio Radicale per estrarre lo stream</p>
    </div>

    <!-- Player Grid -->
    <div class="player-grid">

      <!-- Player Column -->
      <div class="player-column">

        <!-- Track Selector -->
        <div id="trackSelectorContainer" class="track-selector">
          <label class="track-selector-label">Seleziona traccia audio</label>
          <div id="trackList" class="track-list"></div>
        </div>

        <!-- Waveform -->
        <div class="waveform">
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
          <div class="wave-bar"></div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section">
          <div class="progress-time">
            <span id="currentTime">00:00:00</span>
            <span id="duration">--:--:--</span>
          </div>
          <div id="progressContainer" class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
            <div id="progressHandle" class="progress-handle"></div>
            <div id="interventiMarkers"></div>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <div class="controls-buttons">
            <button id="backwardBtn" class="control-btn" disabled title="Indietro 15 secondi">
              <svg fill="currentColor" viewBox="0 0 24 24">
                <path d="M11.99 5V1l-5 5 5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6h-2c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8zm-1.1 11h-.85v-3.26l-1.01.31v-.69l1.77-.63h.09V16zm4.28-1.76c0 .32-.03.6-.1.82s-.17.42-.29.57-.28.26-.45.33-.37.1-.59.1-.41-.03-.59-.1-.33-.18-.46-.33-.23-.34-.3-.57-.11-.5-.11-.82v-.74c0-.32.03-.6.1-.82s.17-.42.29-.57.28-.26.45-.33.37-.1.59-.1.41.03.59.1.33.18.46.33.23.34.3.57.11.5.11.82v.74zm-.85-.86c0-.19-.01-.35-.04-.48s-.07-.23-.12-.31-.11-.14-.19-.17-.16-.05-.25-.05-.18.02-.25.05-.14.09-.19.17-.09.18-.12.31-.04.29-.04.48v.97c0 .19.01.35.04.48s.07.24.12.32.11.14.19.17.16.05.25.05.18-.02.25-.05.14-.09.19-.17.09-.19.11-.32.04-.29.04-.48v-.97z"/>
              </svg>
            </button>
            <button id="playBtn" class="control-btn play" disabled>
              <svg fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </button>
            <button id="forwardBtn" class="control-btn" disabled title="Avanti 15 secondi">
              <svg fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8zm-.86 11h-.85v-3.26l-1.01.31v-.69l1.77-.63h.09V16zm4.28-1.76c0 .32-.03.6-.1.82s-.17.42-.29.57-.28.26-.45.33-.37.1-.59.1-.41-.03-.59-.1-.33-.18-.46-.33-.23-.34-.3-.57-.11-.5-.11-.82v-.74c0-.32.03-.6.1-.82s.17-.42.29-.57.28-.26.45-.33.37-.1.59-.1.41.03.59.1.33.18.46.33.23.34.3.57.11.5.11.82v.74zm-.85-.86c0-.19-.01-.35-.04-.48s-.07-.23-.12-.31-.11-.14-.19-.17-.16-.05-.25-.05-.18.02-.25.05-.14.09-.19.17-.09.18-.12.31-.04.29-.04.48v.97c0 .19.01.35.04.48s.07.24.12.32.11.14.19.17.16.05.25.05.18-.02.25-.05.14-.09.19-.17.09-.19.11-.32.04-.29.04-.48v-.97z"/>
              </svg>
            </button>
          </div>
          <div class="controls-status" id="status">Inserisci un URL</div>
        </div>

        <!-- Speed Control -->
        <div class="speed-control">
          <span class="speed-icon">⚡</span>
          <input 
            type="range" 
            id="speedSlider" 
            class="speed-slider" 
            min="0.5" 
            max="2.5" 
            step="0.1" 
            value="1.0"
          >
          <span id="speedDisplay" class="speed-display">1.0x</span>
        </div>

        <!-- Messages -->
        <div id="loading" class="message loading">
          <span class="loading-spinner"></span>
          <span id="loadingText">Caricamento...</span>
        </div>
        <div id="success" class="message success"></div>
        <div id="error" class="message error"></div>

      </div>

      <!-- Interventi Column -->
      <div id="interventiContainer" class="interventi-container">
        <div class="interventi-header">INTERVENTI</div>
        <div id="interventiList" class="interventi-list"></div>
      </div>

    </div>

    <audio id="video" preload="metadata"></audio>

  </main>

  <!-- Footer -->
  <footer>
    <p class="footer-disclaimer">
      Questo progetto non è affiliato in alcun modo con <a href="https://www.radioradicale.it" target="_blank" rel="noopener noreferrer">Radio Radicale</a>.
    </p>
    <div class="footer-credits">
      <span>built with <a href="https://claude.ai" target="_blank" rel="noopener noreferrer">Claude.ai</a> by simo501</span>
      <a href="https://github.com/simo501/radio-radicale-alt-ui" target="_blank" rel="noopener noreferrer" aria-label="Codice sorgente su GitHub">
        <svg fill="currentColor" viewBox="0 0 24 24">
          <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
        </svg>
      </a>
    </div>
    <p class="footer-license">
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">Licenza CC BY-NC-SA 4.0</a>
    </p>
  </footer>

  <script>
    // ── DOM Elements ──
    const video = document.getElementById('video');
    const playBtn = document.getElementById('playBtn');
    const backwardBtn = document.getElementById('backwardBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const currentTimeDisplay = document.getElementById('currentTime');
    const durationDisplay = document.getElementById('duration');
    const statusDisplay = document.getElementById('status');
    const speedSlider = document.getElementById('speedSlider');
    const speedDisplay = document.getElementById('speedDisplay');
    const loading = document.getElementById('loading');
    const loadingText = document.getElementById('loadingText');
    const errorBox = document.getElementById('error');
    const successBox = document.getElementById('success');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const progressHandle = document.getElementById('progressHandle');
    const interventiMarkers = document.getElementById('interventiMarkers');
    const pageUrlInput = document.getElementById('pageUrlInput');
    const loadBtn = document.getElementById('loadBtn');
    const clearBtn = document.getElementById('clearBtn');
    const trackSelectorContainer = document.getElementById('trackSelectorContainer');
    const trackList = document.getElementById('trackList');
    const interventiContainer = document.getElementById('interventiContainer');
    const interventiList = document.getElementById('interventiList');
    const mainTitle = document.getElementById('mainTitle');
    const mainSubtitle = document.getElementById('mainSubtitle');
    const curaDi = document.getElementById('curaDi');
    const waveBars = document.querySelectorAll('.wave-bar');

    // ── State ──
    let isPlaying = false;
    let isSeeking = false;
    let currentHls = null;
    let availableTracks = [];
    let currentTrackIndex = 0;
    let interventi = [];

    // ── URL Parameter Handling ──
    function getUrlParameter(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    function autoLoadFromUrl() {
      const urlParam = getUrlParameter('url');
      if (urlParam) {
        pageUrlInput.value = decodeURIComponent(urlParam);
        clearBtn.classList.add('visible');
        loadBtn.click();
      }
    }

    // ── Utility Functions ──
    const formatTime = seconds => {
      if (!isFinite(seconds)) return '--:--:--';
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = Math.floor(seconds % 60);
      return h > 0 
        ? `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}` 
        : `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    };

    const parseDuration = str => {
      const h = (str.match(/(\d+)\s*ora/) || [0, 0])[1] * 3600;
      const m = (str.match(/(\d+)\s*min/) || [0, 0])[1] * 60;
      const s = (str.match(/(\d+)\s*sec/) || [0, 0])[1];
      return parseInt(h) + parseInt(m) + parseInt(s);
    };

    const updateTitle = (title, index, total, curator) => {
      mainTitle.textContent = title || 'Radio Radicale Player';
      mainSubtitle.textContent = total > 0 ? `Traccia ${index + 1} di ${total}` : 'Streaming Audio';
      
      if (curator) {
        curaDi.textContent = curator;
        curaDi.style.display = 'block';
      } else {
        curaDi.style.display = 'none';
      }
    };

    // ── Input Handlers ──
    pageUrlInput.addEventListener('input', () => {
      clearBtn.classList.toggle('visible', pageUrlInput.value.length > 0);
    });

    clearBtn.addEventListener('click', () => {
      pageUrlInput.value = '';
      clearBtn.classList.remove('visible');
      pageUrlInput.focus();
    });

    let lastTap = 0;
    pageUrlInput.addEventListener('click', () => {
      const now = Date.now();
      if (now - lastTap < 500) pageUrlInput.select();
      lastTap = now;
    });

    let longPress;
    pageUrlInput.addEventListener('touchstart', () => {
      longPress = setTimeout(() => pageUrlInput.select(), 500);
    });
    pageUrlInput.addEventListener('touchend', () => clearTimeout(longPress));
    pageUrlInput.addEventListener('touchmove', () => clearTimeout(longPress));

    // ── Interventi Markers ──
    function createInterventiMarkers() {
      if (!video.duration || !interventi.length) return;
      
      interventiMarkers.innerHTML = '';
      const currentTrackInterventi = interventi.filter(int => int.file === currentTrackIndex);
      
      currentTrackInterventi.forEach(int => {
        const marker = document.createElement('div');
        const position = (int.offset / video.duration) * 100;
        
        marker.className = `intervento-marker ${int.tipo}`;
        marker.style.left = position + '%';
        marker.title = int.tipo === 'paragrafo' ? int.titolo : int.nome;
        
        marker.addEventListener('click', e => {
          e.stopPropagation();
          video.currentTime = int.offset;
          if (!isPlaying) video.play();
        });
        
        interventiMarkers.appendChild(marker);
      });
    }

    // ── Data Extraction ──
    async function extractData(pageUrl) {
      loadingText.textContent = 'Estrazione dati...';
      
      let html;
      try {
        const res = await fetch(pageUrl);
        html = await res.text();
      } catch {
        loadingText.textContent = 'Uso proxy CORS...';
        const res = await fetch('https://corsproxy.io/?' + encodeURIComponent(pageUrl));
        html = await res.text();
      }
      
      const match = html.match(/Drupal\.settings\s*,\s*({[\s\S]*?})\);/);
      if (!match) throw new Error('Dati non trovati');
      
      const settings = JSON.parse(match[1]);
      if (!settings.RRscheda) throw new Error('RRscheda non trovato');
      
      const rrscheda = settings.RRscheda;
      
      // Extract tracks
      const tracks = [];
      if (rrscheda.playlist) {
        rrscheda.playlist.forEach((item, i) => {
          if (item.sources?.[0]?.src) {
            tracks.push({
              url: item.sources[0].src,
              title: item.title || `Traccia ${i + 1}`,
              index: i
            });
          }
        });
      }
      
      // Extract curator
      let curatore = '';
      const curaDiMatch = html.match(/<div class="secondo_suffisso[^"]*">[\s\S]*?<span class=['"]elenco-nomi-label['"]>A cura di<\/span>&nbsp;([^<]+)<\/div>/);
      if (curaDiMatch) {
        curatore = 'A cura di ' + curaDiMatch[1].trim();
      }
      
      // Extract interventi
      const interventi = [];
      let order = 0;
      const liPattern = /<li class="(int\d+)[^"]*"[^>]*>([\s\S]*?)<\/li>/g;
      let liMatch;
      
      while ((liMatch = liPattern.exec(html))) {
        const id = liMatch[1];
        const content = liMatch[2];
        const isParagrafo = liMatch[0].includes('paragrafo');
        
        let offset = 0, file = 0;
        if (rrscheda.interventi?.[id]) {
          offset = rrscheda.interventi[id].offset || 0;
          file = rrscheda.interventi[id].file || 0;
        }
        
        if (isParagrafo) {
          const m = content.match(/<p class="strong descrizione">([^<]+)<\/p>/);
          if (m) {
            interventi.push({
              tipo: 'paragrafo',
              titolo: m[1].trim(),
              offset, file,
              htmlOrder: order++
            });
          }
        } else {
          const section = content.match(/<div class="int_name_section">([\s\S]*?)<\/div>/);
          if (section) {
            const html = section[1];
            const nomi = [...html.matchAll(/<h2>([^<]+)<\/h2>/g)].map(m => m[1].trim());
            const ruoli = [...html.matchAll(/<p>([^<]+)<\/p>/g)]
              .map(m => m[1].trim())
              .filter(t => !t.includes('Durata:') && !t.match(/^\d+:\d+/));
            
            const durataM = html.match(/Durata:\s*([^<]+)/);
            const durata = durataM ? durataM[1].trim() : '';
            const orarioM = html.match(/(\d+:\d+)\s+Durata:/);
            const orario = orarioM ? orarioM[1] : '';
            
            nomi.forEach((nome, i) => {
              interventi.push({
                tipo: 'intervento',
                nome,
                ruolo: ruoli[i] || '',
                durata,
                orario,
                offset, file,
                htmlOrder: order++
              });
            });
          }
        }
      }
      
      return { tracks, interventi, curatore };
    }

    // ── Display Functions ──
    function displayInterventi(data) {
      interventi = data;
      if (!data.length) {
        interventiContainer.classList.remove('visible');
        return;
      }
      
      interventiContainer.classList.add('visible');
      interventiList.innerHTML = '';
      
      data.forEach(int => {
        const div = document.createElement('div');
        
        if (int.tipo === 'paragrafo') {
          div.className = 'intervento-item paragrafo';
          div.innerHTML = `<div class="intervento-title">${int.titolo}</div>`;
        } else {
          div.className = 'intervento-item clickable';
          
          let html = `<div class="intervento-name">${int.nome}</div>`;
          if (int.ruolo) html += `<div class="intervento-role">${int.ruolo}</div>`;
          if (int.durata) html += `<div class="intervento-duration">${int.durata}</div>`;
          
          html += `<div class="intervento-meta">`;
          if (int.orario) html += `${int.orario} - `;
          if (int.file > 0) html += `File ${int.file + 1} - `;
          html += `${formatTime(int.offset)}</div>`;
          
          div.innerHTML = html;
          
          div.addEventListener('click', () => {
            if (int.file !== currentTrackIndex && availableTracks[int.file]) {
              currentTrackIndex = int.file;
              loadTrack(int.file, int.offset);
              if (availableTracks.length > 1) displayTrackSelector(availableTracks);
            } else {
              video.currentTime = int.offset;
              if (!isPlaying) video.play();
            }
            
            interventiList.querySelectorAll('.intervento-item').forEach(el => {
              el.classList.remove('active');
            });
            div.classList.add('active');
          });
        }
        
        interventiList.appendChild(div);
      });
    }

    function displayTrackSelector(tracks) {
      availableTracks = tracks;
      if (tracks.length === 1) {
        trackSelectorContainer.classList.remove('visible');
        return;
      }
      
      trackSelectorContainer.classList.add('visible');
      trackList.innerHTML = '';
      
      tracks.forEach((track, i) => {
        const btn = document.createElement('button');
        const active = i === currentTrackIndex;
        btn.className = `track-btn ${active ? 'active' : ''}`;
        
        btn.innerHTML = `
          <div class="track-btn-number">${i + 1}</div>
          <div class="track-btn-info">
            <div class="track-btn-title">${track.title}</div>
            <div class="track-btn-subtitle">Parte ${i + 1} di ${tracks.length}</div>
          </div>
          <div class="track-btn-icon">▶</div>
        `;
        
        btn.addEventListener('click', () => {
          currentTrackIndex = i;
          loadTrack(i);
          displayTrackSelector(tracks);
        });
        
        trackList.appendChild(btn);
      });
    }

    // ── Player Functions ──
    function loadTrack(index, startTime = 0) {
      if (index < 0 || index >= availableTracks.length) return;
      
      const track = availableTracks[index];
      currentTrackIndex = index;
      updateTitle(track.title, index, availableTracks.length, track.curator);
      initPlayer(track.url, startTime);
    }

    function initPlayer(src, startTime = 0) {
      if (currentHls) {
        currentHls.destroy();
        currentHls = null;
      }
      
      if (video.src) {
        video.pause();
        video.src = '';
      }
      
      isPlaying = false;
      playBtn.innerHTML = '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
      progressBar.style.width = '0%';
      progressHandle.style.left = '0%';
      currentTimeDisplay.textContent = '00:00:00';
      durationDisplay.textContent = '--:--:--';
      loadingText.textContent = 'Inizializzazione...';
      loading.classList.add('visible');
      
      const onReady = () => {
        statusDisplay.textContent = 'Pronto';
        loading.classList.remove('visible');
        playBtn.disabled = false;
        backwardBtn.disabled = false;
        forwardBtn.disabled = false;
        if (startTime > 0) video.currentTime = startTime;
        
        createInterventiMarkers();
        
        successBox.textContent = '✓ Traccia caricata!';
        successBox.classList.add('visible');
        setTimeout(() => successBox.classList.remove('visible'), 3000);
      };
      
      if (Hls.isSupported()) {
        currentHls = new Hls();
        currentHls.loadSource(src);
        currentHls.attachMedia(video);
        currentHls.on(Hls.Events.MANIFEST_PARSED, onReady);
        currentHls.on(Hls.Events.ERROR, (e, data) => {
          if (data.fatal) {
            errorBox.textContent = 'Errore: ' + (data.details || 'unknown');
            errorBox.classList.add('visible');
            loading.classList.remove('visible');
            playBtn.disabled = true;
            backwardBtn.disabled = true;
            forwardBtn.disabled = true;
          }
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = src;
        video.addEventListener('loadedmetadata', onReady, { once: true });
      } else {
        errorBox.textContent = 'Browser non supporta HLS';
        errorBox.classList.add('visible');
        loading.classList.remove('visible');
      }
    }

    // ── Load Handler ──
    async function loadFromUrl(url) {
      if (!url) {
        errorBox.textContent = 'Inserisci un URL';
        errorBox.classList.add('visible');
        return;
      }
      if (!url.includes('radioradicale.it')) {
        errorBox.textContent = 'URL non valido';
        errorBox.classList.add('visible');
        return;
      }
      
      errorBox.classList.remove('visible');
      successBox.classList.remove('visible');
      trackSelectorContainer.classList.remove('visible');
      interventiContainer.classList.remove('visible');
      loading.classList.add('visible');
      loadBtn.disabled = true;
      playBtn.disabled = true;
      backwardBtn.disabled = true;
      forwardBtn.disabled = true;
      statusDisplay.textContent = 'Caricamento...';
      
      try {
        const data = await extractData(url);
        if (!data.tracks.length) throw new Error('Nessuna traccia');
        
        data.tracks.forEach(t => t.curator = data.curatore);
        
        displayTrackSelector(data.tracks);
        displayInterventi(data.interventi);
        loadTrack(0);
        loading.classList.remove('visible');
      } catch (err) {
        errorBox.textContent = err.message || 'Errore';
        errorBox.classList.add('visible');
        loading.classList.remove('visible');
        statusDisplay.textContent = 'Errore';
      } finally {
        loadBtn.disabled = false;
      }
    }

    // ── Event Listeners ──
    loadBtn.addEventListener('click', async () => {
      const url = pageUrlInput.value.trim();
      await loadFromUrl(url);
    });

    pageUrlInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') loadBtn.click();
    });

    playBtn.addEventListener('click', () => {
      if (isPlaying) {
        video.pause();
      } else {
        video.play();
      }
    });
    
    backwardBtn.addEventListener('click', () => {
      video.currentTime = Math.max(0, video.currentTime - 15);
    });
    
    forwardBtn.addEventListener('click', () => {
      video.currentTime = Math.min(video.duration, video.currentTime + 15);
    });

    video.addEventListener('play', () => {
      isPlaying = true;
      playBtn.innerHTML = '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>';
      statusDisplay.textContent = 'In riproduzione';
      waveBars.forEach(b => b.classList.add('playing'));
    });
    
    video.addEventListener('pause', () => {
      isPlaying = false;
      playBtn.innerHTML = '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
      statusDisplay.textContent = 'In pausa';
      waveBars.forEach(b => b.classList.remove('playing'));
    });
    
    video.addEventListener('ended', () => {
      if (currentTrackIndex < availableTracks.length - 1) {
        currentTrackIndex++;
        loadTrack(currentTrackIndex);
        displayTrackSelector(availableTracks);
        video.addEventListener('loadedmetadata', () => video.play(), { once: true });
      }
    });

    video.addEventListener('loadedmetadata', () => {
      durationDisplay.textContent = formatTime(video.duration);
      createInterventiMarkers();
    });
    
    video.addEventListener('durationchange', () => {
      durationDisplay.textContent = formatTime(video.duration);
      createInterventiMarkers();
    });
    
    video.addEventListener('timeupdate', () => {
      if (!isSeeking && video.duration) {
        const pct = (video.currentTime / video.duration) * 100;
        progressBar.style.width = pct + '%';
        progressHandle.style.left = pct + '%';
        currentTimeDisplay.textContent = formatTime(video.currentTime);
      }
    });

    // ── Progress Bar Seeking ──
    const seek = e => {
      const rect = progressContainer.getBoundingClientRect();
      const x = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
      const pct = Math.max(0, Math.min(1, (x - rect.left) / rect.width));
      const time = pct * video.duration;
      
      if (isFinite(time)) {
        progressBar.style.width = (pct * 100) + '%';
        progressHandle.style.left = (pct * 100) + '%';
        currentTimeDisplay.textContent = formatTime(time);
      }
      return pct;
    };

    const startSeeking = e => {
      e.preventDefault();
      isSeeking = true;
      progressHandle.classList.add('seeking');
      seek(e);
      document.addEventListener('mousemove', seek);
      document.addEventListener('touchmove', seek);
      document.addEventListener('mouseup', stopSeeking);
      document.addEventListener('touchend', stopSeeking);
    };

    const stopSeeking = e => {
      if (!isSeeking) return;
      const pct = seek(e);
      if (isFinite(pct * video.duration)) video.currentTime = pct * video.duration;
      
      isSeeking = false;
      progressHandle.classList.remove('seeking');
      document.removeEventListener('mousemove', seek);
      document.removeEventListener('touchmove', seek);
      document.removeEventListener('mouseup', stopSeeking);
      document.removeEventListener('touchend', stopSeeking);
    };

    progressContainer.addEventListener('mousedown', startSeeking);
    progressContainer.addEventListener('touchstart', startSeeking);

    // ── Speed Control ──
    speedSlider.addEventListener('input', e => {
      const speed = parseFloat(e.target.value);
      video.playbackRate = speed;
      speedDisplay.textContent = speed.toFixed(1) + 'x';
    });
    
    video.playbackRate = 1.0;

    // ── Initialize ──
    window.addEventListener('DOMContentLoaded', autoLoadFromUrl);
  </script>

</body>
</html>
